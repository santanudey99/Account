image: alpine:3.6

stages:
  - deploy

cache:
  paths:
    - binary-cache

  before_script:
    - apk add --no-cache curl ca-certificates
    # create the binary-cache folder if not present
    - test -d binary-cache || mkdir binary-cache
    # install kubectl binary into binary-cache if not already present
    - test -f binary-cache/kubectl || curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.7.2/bin/linux/amd64/kubectl
    - test -f binary-cache/kubectl || mv kubectl binary-cache/kubectl
    # install kubectl binary into /usr/local/bin if not already present
    - test -f /usr/local/bin/kubectl || install -m 770 binary-cache/kubectl /usr/local/bin

deploy_live:
  stage: deploy
  environment:
    name: live
    url: https:/lkq-vmn.com
  script:
    - kubectl version
    - kubectl set image deployment nginx nginx=nginx:1.11.5 --record